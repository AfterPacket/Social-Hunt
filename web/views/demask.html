<h2>Forensic AI Demasking</h2>
<div class="card">
    <p class="muted" style="margin-bottom: 20px">
        This tool uses a multi-stage AI pipeline to reconstruct facial features.
        First, a face detector auto-generates a mask over the covered region and
        <b>Stable Diffusion Inpainting</b> fills <em>only that region</em> —
        leaving hair, skin tone, eyebrows and all surrounding identity cues
        untouched, which prevents gender swaps and full-image hallucinations.
        Second, <b>CodeFormer</b> is applied at balanced fidelity to sharpen the
        inpainted area without replacing the generated face.
    </p>
    <p
        class="muted warning"
        style="margin-bottom: 20px; color: var(--warning-text)"
    >
        <b>Warning:</b> This feature is experimental. No AI can know what a
        person's face truly looks like beneath a covering — results are
        plausible reconstructions, not ground truth. Always verify against
        primary source material.
    </p>

    <div style="display: flex; gap: 20px; flex-wrap: wrap">
        <!-- Upload & Controls -->
        <div style="flex: 1; min-width: 320px">
            <div class="form-group">
                <label>Target Image</label>
                <div
                    style="
                        border: 2px dashed rgba(255, 255, 255, 0.1);
                        padding: 20px;
                        border-radius: 8px;
                        text-align: center;
                    "
                >
                    <input
                        type="file"
                        id="demaskUpload"
                        accept="image/*"
                        style="display: none"
                    />
                    <button
                        class="btn"
                        onclick="
                            document.getElementById('demaskUpload').click()
                        "
                    >
                        Choose Photo
                    </button>
                    <div
                        id="demaskPreviewContainer"
                        style="display: none; margin-top: 15px"
                    >
                        <img
                            id="demaskOriginalPreview"
                            src=""
                            style="
                                max-width: 100%;
                                border-radius: 4px;
                                border: 1px solid var(--border);
                            "
                        />
                    </div>
                </div>
            </div>

            <div
                id="demaskStatus"
                class="muted"
                style="margin: 15px 0; font-size: 0.9rem"
            >
                Ready for analysis.
            </div>

            <button
                id="startDemaskBtn"
                class="btn good"
                style="width: 100%"
                disabled
            >
                Start AI Reconstruction
            </button>
        </div>

        <!-- Result View -->
        <div
            style="
                flex: 1;
                min-width: 320px;
                display: flex;
                flex-direction: column;
            "
        >
            <div
                id="demaskResultContainer"
                class="tablewrap"
                style="
                    flex: 1;
                    border: 1px solid var(--border);
                    border-radius: 8px;
                    min-height: 300px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background: rgba(0, 0, 0, 0.2);
                "
            >
                <div
                    id="demaskPlaceholder"
                    class="muted"
                    style="text-align: center; padding: 20px"
                >
                    Processed image will appear here.
                </div>
                <img
                    id="demaskResultImg"
                    src=""
                    style="display: none; max-width: 100%; border-radius: 4px"
                />
            </div>

            <div
                id="demaskActions"
                style="display: none; gap: 10px; margin-top: 15px"
            >
                <button id="downloadDemaskBtn" class="btn" style="flex: 1">
                    Download PNG
                </button>
                <button id="saveDemaskToNotesBtn" class="btn" style="flex: 1">
                    Save to Notes
                </button>
            </div>
        </div>
    </div>
</div>

<div class="card" style="margin-top: 20px; border-left: 4px solid var(--warn)">
    <div style="font-weight: 800; color: var(--warn); margin-bottom: 5px">
        Forensic Disclaimer
    </div>
    <div class="muted" style="font-size: 0.85rem; line-height: 1.4">
        Reconstructions are plausible estimates generated by neural networks —
        they are not ground truth. The SD inpainting step constrains changes to
        the detected face-covering region only, significantly reducing identity
        distortion compared to full-image generation. Requires a
        <code>REPLICATE_API_TOKEN</code> configured in Settings.
    </div>
</div>
